# Lesson 1.10: Testing GET Endpoints

## A. Concept Overview

### What & Why
**GET endpoint testing** focuses on verifying data retrieval operations work correctly. It's important because GET requests are the most common HTTP methodâ€”they power searches, listings, detail views, and data fetching across all applications.

### Analogy
Think of GET requests like browsing a library. You can:
- Look at the entire catalog (GET /books)
- Search for specific topics (GET /books?genre=fiction)
- Get details on one book (GET /books/123)
- Check if a book exists (GET /books/rare-title)

GET testing ensures the library catalog is accurate, complete, and accessible!

---

## B. Types of GET Requests to Test

### 1. List/Collection Endpoints
```
GET /api/users           â†’ Get all users
GET /api/products        â†’ Get all products
GET /api/orders          â†’ Get all orders
```

### 2. Single Resource Endpoints
```
GET /api/users/123       â†’ Get user with ID 123
GET /api/products/abc    â†’ Get product with ID abc
```

### 3. Filtered/Search Endpoints
```
GET /api/users?role=admin              â†’ Filter by role
GET /api/products?category=electronics  â†’ Filter by category
GET /api/orders?status=pending          â†’ Filter by status
```

### 4. Paginated Endpoints
```
GET /api/users?page=1&limit=10         â†’ First 10 users
GET /api/products?offset=20&limit=10   â†’ Next 10 products
```

### 5. Nested Resource Endpoints
```
GET /api/users/123/orders              â†’ Orders for user 123
GET /api/posts/456/comments            â†’ Comments on post 456
```

---

## C. Testing Collection Endpoints

File: `tests/test_get_collections.py`
```python
"""
Test GET requests for collection endpoints.
"""
import httpx


def test_get_all_users_returns_200():
    """Test that GET /users returns 200 OK."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users")
        assert response.status_code == 200


def test_get_all_users_returns_list():
    """Test that response is a list of users."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users")
        
        assert response.status_code == 200
        data = response.json()
        
        # Should be a list
        assert isinstance(data, list)
        # Should have multiple users
        assert len(data) > 0


def test_get_all_users_structure():
    """Test that each user has expected fields."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users")
        data = response.json()
        
        # Check first user has required fields
        first_user = data[0]
        assert "id" in first_user
        assert "name" in first_user
        assert "email" in first_user
        assert "username" in first_user


def test_get_all_posts_count():
    """Test that we get expected number of posts."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/posts")
        
        assert response.status_code == 200
        data = response.json()
        
        # JSONPlaceholder has 100 posts
        assert len(data) == 100


def test_collection_response_content_type():
    """Test that collection endpoint returns JSON."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users")
        
        assert response.status_code == 200
        assert "application/json" in response.headers["content-type"]
```

---

## D. Testing Single Resource Endpoints

File: `tests/test_get_single_resource.py`
```python
"""
Test GET requests for single resource endpoints.
"""
import httpx


def test_get_user_by_id_returns_200():
    """Test getting a specific user by ID."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users/1")
        assert response.status_code == 200


def test_get_user_by_id_returns_correct_user():
    """Test that response contains the requested user."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        user_id = 1
        response = client.get(f"/users/{user_id}")
        
        assert response.status_code == 200
        data = response.json()
        
        # Verify it's the correct user
        assert data["id"] == user_id


def test_get_user_has_complete_data():
    """Test that user response has all expected fields."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users/1")
        data = response.json()
        
        # Required fields
        assert "id" in data
        assert "name" in data
        assert "username" in data
        assert "email" in data
        assert "address" in data
        assert "phone" in data
        assert "website" in data
        assert "company" in data


def test_get_nonexistent_user_returns_404():
    """Test that requesting non-existent user returns 404."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users/99999")
        assert response.status_code == 404


def test_get_post_by_id():
    """Test getting a specific post."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        post_id = 1
        response = client.get(f"/posts/{post_id}")
        
        assert response.status_code == 200
        data = response.json()
        
        assert data["id"] == post_id
        assert "title" in data
        assert "body" in data
        assert "userId" in data


def test_get_multiple_users_by_id():
    """Test getting multiple users individually."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        user_ids = [1, 2, 3, 4, 5]
        
        for user_id in user_ids:
            response = client.get(f"/users/{user_id}")
            assert response.status_code == 200
            
            data = response.json()
            assert data["id"] == user_id
```

---

## E. Testing with Query Parameters

File: `tests/test_get_with_query_params.py`
```python
"""
Test GET requests with query parameters.
"""
import httpx


def test_filter_posts_by_user():
    """Test filtering posts by userId query parameter."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        user_id = 1
        response = client.get("/posts", params={"userId": user_id})
        
        assert response.status_code == 200
        data = response.json()
        
        # All posts should be from this user
        assert len(data) > 0
        for post in data:
            assert post["userId"] == user_id


def test_filter_with_multiple_parameters():
    """Test filtering with multiple query parameters."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/comments", params={
            "postId": 1,
            "email": "Eliseo@gardner.biz"
        })
        
        assert response.status_code == 200
        # May return empty list if no match, but should not error


def test_query_params_url_encoding():
    """Test that special characters in query params are encoded."""
    with httpx.Client(base_url="https://httpbin.org") as client:
        params = {
            "key": "value with spaces",
            "special": "chars!@#$%"
        }
        response = client.get("/get", params=params)
        
        assert response.status_code == 200
        data = response.json()
        
        # httpbin echoes back the args
        assert data["args"]["key"] == "value with spaces"
        assert data["args"]["special"] == "chars!@#$%"


def test_empty_query_params():
    """Test GET with no query parameters."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users", params={})
        
        assert response.status_code == 200
        # Should return all users


def test_array_query_parameters():
    """Test sending array values in query parameters."""
    with httpx.Client(base_url="https://httpbin.org") as client:
        # Multiple values for same key
        params = {"id": ["1", "2", "3"]}
        response = client.get("/get", params=params)
        
        assert response.status_code == 200
        data = response.json()
        
        # httpbin shows array parameters
        assert "id" in data["args"]
```

---

## F. Testing Nested Resources

File: `tests/test_get_nested_resources.py`
```python
"""
Test GET requests for nested resource endpoints.
"""
import httpx


def test_get_posts_for_user():
    """Test getting all posts for a specific user."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        user_id = 1
        response = client.get(f"/users/{user_id}/posts")
        
        # This endpoint may return 404 on JSONPlaceholder
        # Use query params instead
        response = client.get("/posts", params={"userId": user_id})
        
        assert response.status_code == 200
        data = response.json()
        
        # All posts should belong to this user
        for post in data:
            assert post["userId"] == user_id


def test_get_comments_for_post():
    """Test getting all comments for a specific post."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        post_id = 1
        response = client.get(f"/posts/{post_id}/comments")
        
        assert response.status_code == 200
        data = response.json()
        
        # Should have comments
        assert len(data) > 0
        
        # All comments should be for this post
        for comment in data:
            assert comment["postId"] == post_id


def test_nested_resource_structure():
    """Test that nested resource has correct structure."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/posts/1/comments")
        data = response.json()
        
        first_comment = data[0]
        assert "id" in first_comment
        assert "postId" in first_comment
        assert "name" in first_comment
        assert "email" in first_comment
        assert "body" in first_comment
```

---

## G. Testing Error Scenarios

File: `tests/test_get_errors.py`
```python
"""
Test GET error scenarios.
"""
import httpx
import pytest


def test_get_nonexistent_endpoint_returns_404():
    """Test that invalid endpoint returns 404."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/nonexistent")
        assert response.status_code == 404


def test_get_invalid_id_format():
    """Test GET with invalid ID format."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        # JSONPlaceholder may handle this differently
        response = client.get("/users/invalid-id")
        # May return 404 or handle gracefully
        assert response.status_code in [404, 200]


def test_get_with_timeout():
    """Test that slow requests timeout appropriately."""
    with httpx.Client(base_url="https://httpbin.org", timeout=2.0) as client:
        # Request should complete within timeout
        response = client.get("/delay/1")
        assert response.status_code == 200


def test_get_timeout_exception():
    """Test that exceeding timeout raises exception."""
    with pytest.raises(httpx.TimeoutException):
        with httpx.Client(base_url="https://httpbin.org", timeout=0.5) as client:
            # This will timeout
            client.get("/delay/10")


def test_get_invalid_url():
    """Test GET to completely invalid URL."""
    with pytest.raises(httpx.InvalidURL):
        httpx.get("not-a-valid-url")
```

---

## H. Response Validation Patterns

File: `tests/test_get_validation.py`
```python
"""
Test GET response validation patterns.
"""
import httpx


def test_validate_response_status():
    """Test status code validation."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users")
        
        # Multiple ways to assert status
        assert response.status_code == 200
        assert response.is_success
        assert not response.is_error


def test_validate_response_headers():
    """Test response headers validation."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users")
        
        # Check important headers exist
        assert "content-type" in response.headers
        assert "content-length" in response.headers
        
        # Check specific values
        assert "application/json" in response.headers["content-type"]


def test_validate_response_body_structure():
    """Test response body structure."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users/1")
        data = response.json()
        
        # Check top-level structure
        assert isinstance(data, dict)
        assert len(data) > 0
        
        # Check nested structure
        assert isinstance(data["address"], dict)
        assert isinstance(data["company"], dict)


def test_validate_data_types():
    """Test that data types are correct."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users/1")
        data = response.json()
        
        # Check types
        assert isinstance(data["id"], int)
        assert isinstance(data["name"], str)
        assert isinstance(data["email"], str)
        assert isinstance(data["address"], dict)


def test_validate_required_fields_present():
    """Test that all required fields are present."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users/1")
        data = response.json()
        
        required_fields = ["id", "name", "username", "email"]
        for field in required_fields:
            assert field in data, f"Missing required field: {field}"


def test_validate_field_values():
    """Test that field values are valid."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        response = client.get("/users/1")
        data = response.json()
        
        # ID should be positive
        assert data["id"] > 0
        
        # Email should contain @
        assert "@" in data["email"]
        
        # Name should not be empty
        assert len(data["name"]) > 0
```

---

## I. Performance Testing for GET

File: `tests/test_get_performance.py`
```python
"""
Test GET endpoint performance.
"""
import httpx
import time


def test_get_response_time():
    """Test that GET request completes within acceptable time."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        start = time.time()
        response = client.get("/users")
        end = time.time()
        
        elapsed = end - start
        
        assert response.status_code == 200
        # Should complete in under 2 seconds
        assert elapsed < 2.0, f"Request took {elapsed:.2f}s, expected < 2.0s"


def test_multiple_get_requests_reuse_connection():
    """Test that multiple requests reuse connection (faster)."""
    with httpx.Client(base_url="https://jsonplaceholder.typicode.com") as client:
        # First request (establishes connection)
        start1 = time.time()
        response1 = client.get("/users/1")
        end1 = time.time()
        
        # Second request (reuses connection, should be faster)
        start2 = time.time()
        response2 = client.get("/users/2")
        end2 = time.time()
        
        elapsed1 = end1 - start1
        elapsed2 = end2 - start2
        
        assert response1.status_code == 200
        assert response2.status_code == 200
        
        # Second request might be faster (connection reuse)
        print(f"First request: {elapsed1:.3f}s, Second: {elapsed2:.3f}s")
```

---

## J. Common GET Testing Patterns

### Pattern 1: Test Happy Path First
```python
def test_get_user_happy_path():
    """Test successful GET request."""
    response = httpx.get("https://api.example.com/users/1")
    assert response.status_code == 200
    data = response.json()
    assert data["id"] == 1
```

### Pattern 2: Test Resource Not Found
```python
def test_get_user_not_found():
    """Test GET for non-existent resource."""
    response = httpx.get("https://api.example.com/users/99999")
    assert response.status_code == 404
```

### Pattern 3: Test List is Not Empty
```python
def test_get_users_returns_data():
    """Test that list endpoint returns data."""
    response = httpx.get("https://api.example.com/users")
    data = response.json()
    assert len(data) > 0
```

### Pattern 4: Test Filtering Works
```python
def test_get_users_filtered():
    """Test filtering returns correct subset."""
    response = httpx.get("https://api.example.com/users?role=admin")
    data = response.json()
    for user in data:
        assert user["role"] == "admin"
```

---

## K. Key Takeaways

ðŸ”‘ **GET is read-only**: Safe, idempotent, no request body  
ðŸ”‘ **Test collections**: List endpoints return arrays  
ðŸ”‘ **Test single resources**: Detail endpoints return objects  
ðŸ”‘ **Use query params**: For filtering, searching, pagination  
ðŸ”‘ **Validate structure**: Check fields, types, nesting  
ðŸ”‘ **Test errors**: 404 for not found, timeouts, invalid IDs  
ðŸ”‘ **Use Client**: Connection pooling for multiple requests  
ðŸ”‘ **Check performance**: Response times matter  

---

## L. Quick Check

Can you answer these?

1. What status code for successful GET?
2. What's the difference between `/users` and `/users/1`?
3. How do you add query parameters with httpx?
4. What should you test for a collection endpoint?
5. What status code for non-existent resource?

---

## M. What's Next?

In **Lesson 1.11: Testing POST Endpoints**, we'll learn:
- Creating resources
- Sending JSON data
- Validating 201 Created responses
- Testing validation errors
- Handling conflicts

You've mastered GET testing! Now let's create some data. ðŸš€

**Ready for lesson 1.11?**
