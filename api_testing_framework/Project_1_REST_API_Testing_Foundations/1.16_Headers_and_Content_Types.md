# Lesson 1.16: Headers and Content Types

## A. Concept Overview

### What & Why
**HTTP headers** carry metadata about requests and responses. They're important because headers control caching, authentication, content type, encoding, and many other critical aspects of HTTP communication.

### Analogy
Headers are like the envelope of a letter. The envelope tells you: who sent it (User-Agent), what's inside (Content-Type), how urgent it is (Cache-Control), and special handling instructions (Authorization). The actual letter content is the body.

---

## B. Common Headers

### Request Headers
```
User-Agent: MyApp/1.0
Accept: application/json
Content-Type: application/json
Authorization: Bearer token123
Accept-Encoding: gzip, deflate
```

### Response Headers
```
Content-Type: application/json; charset=utf-8
Content-Length: 1234
Cache-Control: max-age=3600
Server: nginx/1.18.0
Date: Mon, 15 Jan 2024 10:30:00 GMT
```

---

## C. Testing Response Headers

```python
import httpx

def test_content_type_json():
    """Test Content-Type header for JSON."""
    response = httpx.get("https://jsonplaceholder.typicode.com/users")
    
    # Check header exists (case-insensitive)
    assert "content-type" in response.headers
    
    # Check value
    content_type = response.headers["content-type"]
    assert "application/json" in content_type


def test_common_response_headers():
    """Test common response headers present."""
    response = httpx.get("https://httpbin.org/get")
    
    # These should typically be present
    assert "content-type" in response.headers
    assert "content-length" in response.headers
    assert "date" in response.headers
    assert "server" in response.headers
    
    # Verify content-length matches body
    content_length = int(response.headers["content-length"])
    actual_length = len(response.content)
    assert content_length == actual_length


def test_cache_headers():
    """Test cache-related headers."""
    response = httpx.get("https://httpbin.org/cache")
    
    if "cache-control" in response.headers:
        cache_control = response.headers["cache-control"]
        print(f"Cache-Control: {cache_control}")
    
    if "etag" in response.headers:
        etag = response.headers["etag"]
        print(f"ETag: {etag}")
```

---

## D. Setting Request Headers

```python
import httpx

def test_custom_request_headers():
    """Test sending custom request headers."""
    headers = {
        "User-Agent": "MyTestSuite/1.0",
        "Accept": "application/json",
        "X-Custom-Header": "custom-value"
    }
    
    response = httpx.get("https://httpbin.org/headers", headers=headers)
    
    assert response.status_code == 200
    data = response.json()
    
    # httpbin echoes back headers
    assert "MyTestSuite" in data["headers"]["User-Agent"]
    assert data["headers"]["X-Custom-Header"] == "custom-value"


def test_authorization_header():
    """Test Authorization header."""
    headers = {
        "Authorization": "Bearer fake-token-123"
    }
    
    response = httpx.get("https://httpbin.org/headers", headers=headers)
    data = response.json()
    
    assert "Bearer fake-token-123" in data["headers"]["Authorization"]


def test_client_default_headers():
    """Test setting default headers on client."""
    default_headers = {
        "User-Agent": "TestClient/1.0",
        "Accept": "application/json"
    }
    
    with httpx.Client(headers=default_headers) as client:
        response = client.get("https://httpbin.org/headers")
        data = response.json()
        
        assert "TestClient" in data["headers"]["User-Agent"]
```

---

## E. Content-Type Deep Dive

```python
def test_json_content_type():
    """Test JSON Content-Type."""
    payload = {"name": "Test"}
    
    response = httpx.post(
        "https://httpbin.org/post",
        json=payload  # Automatically sets Content-Type: application/json
    )
    
    data = response.json()
    assert "application/json" in data["headers"]["Content-Type"]


def test_form_content_type():
    """Test form Content-Type."""
    form_data = {"username": "test", "password": "secret"}
    
    response = httpx.post(
        "https://httpbin.org/post",
        data=form_data  # Sets Content-Type: application/x-www-form-urlencoded
    )
    
    data = response.json()
    assert "application/x-www-form-urlencoded" in data["headers"]["Content-Type"]


def test_accept_header():
    """Test Accept header for content negotiation."""
    headers = {"Accept": "application/json"}
    
    response = httpx.get("https://httpbin.org/get", headers=headers)
    
    # Server should respond with JSON
    assert "application/json" in response.headers["content-type"]
```

---

## F. Key Takeaways

ðŸ”‘ **Headers**: Metadata about request/response  
ðŸ”‘ **Content-Type**: Specifies body format  
ðŸ”‘ **Authorization**: Carries auth credentials  
ðŸ”‘ **Accept**: Client's preferred response format  
ðŸ”‘ **Case-insensitive**: Header names not case sensitive  
ðŸ”‘ **httpx**: Easy header access via dict-like interface  

---

## G. What's Next?

In **Lesson 1.17: Query Parameters and Path Parameters**, we'll master URL parameters.

Ready for lesson 1.17? ðŸš€
