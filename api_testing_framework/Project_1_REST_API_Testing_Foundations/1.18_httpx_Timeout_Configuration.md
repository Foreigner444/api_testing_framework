# Lesson 1.18: httpx Timeout Configuration

## A. Concept Overview

### What & Why
**Timeouts** prevent tests from hanging indefinitely when servers are slow or unresponsive. They're critical for test reliability and determining acceptable response times.

### Analogy
Timeouts are like ordering food delivery - you don't wait forever. You set expectations: 30 minutes for connection (restaurant answers), 60 minutes for delivery (food arrives). If exceeded, you cancel and try elsewhere.

---

## B. Default Timeout

```python
import httpx

# httpx default: 5 seconds for all operations
response = httpx.get("https://httpbin.org/delay/2")  # Works (2s < 5s)

# This might timeout with defaults
# response = httpx.get("https://httpbin.org/delay/10")  # Fails (10s > 5s)
```

---

## C. Setting Request Timeout

```python
import httpx

# Set timeout for single request
response = httpx.get(
    "https://httpbin.org/delay/3",
    timeout=10.0  # 10 second timeout
)

# Disable timeout (wait forever - not recommended!)
response = httpx.get(
    "https://httpbin.org/delay/5",
    timeout=None
)
```

---

## D. Client Timeout Configuration

```python
import httpx

# Set timeout for all requests in client
with httpx.Client(timeout=10.0) as client:
    response = client.get("https://httpbin.org/delay/2")
    assert response.status_code == 200
```

---

## E. Granular Timeout Configuration

```python
import httpx

# Different timeouts for different phases
timeout = httpx.Timeout(
    connect=5.0,  # 5s to establish connection
    read=10.0,    # 10s to read response
    write=5.0,    # 5s to write request
    pool=5.0      # 5s to acquire connection from pool
)

with httpx.Client(timeout=timeout) as client:
    response = client.get("https://httpbin.org/delay/2")
    assert response.status_code == 200
```

---

## F. Testing Timeout Scenarios

```python
import httpx
import pytest

def test_request_within_timeout():
    """Test that fast request completes."""
    response = httpx.get(
        "https://httpbin.org/delay/1",
        timeout=5.0
    )
    assert response.status_code == 200


def test_timeout_exception():
    """Test that slow request times out."""
    with pytest.raises(httpx.TimeoutException):
        httpx.get(
            "https://httpbin.org/delay/10",
            timeout=1.0  # Will timeout
        )


def test_connect_timeout():
    """Test connect timeout."""
    timeout = httpx.Timeout(connect=0.1)
    
    # Might timeout trying to connect
    with pytest.raises(httpx.TimeoutException):
        httpx.get(
            "https://httpbin.org/delay/1",
            timeout=timeout
        )
```

---

## G. Production Timeout Strategy

```python
import httpx

def get_production_client():
    """Create client with production timeouts."""
    timeout = httpx.Timeout(
        connect=5.0,   # 5s to connect
        read=30.0,     # 30s to read (for slow endpoints)
        write=10.0,    # 10s to write
        pool=5.0       # 5s for pool
    )
    
    return httpx.Client(timeout=timeout)


def test_with_production_timeouts():
    """Test using production timeout config."""
    with get_production_client() as client:
        response = client.get("https://httpbin.org/delay/2")
        assert response.status_code == 200
```

---

## H. Key Takeaways

ðŸ”‘ **Default**: 5 seconds for all operations  
ðŸ”‘ **timeout=X**: Set timeout in seconds  
ðŸ”‘ **timeout=None**: Disable (not recommended)  
ðŸ”‘ **Granular**: Different timeouts per phase  
ðŸ”‘ **TimeoutException**: Raised when exceeded  
ðŸ”‘ **Production**: Use reasonable timeouts  
ðŸ”‘ **Testing**: Test both success and timeout cases  

---

## I. What's Next?

In **Lesson 1.19: Best Practices for REST API Tests**, we'll wrap up Project 1 with comprehensive best practices!

Ready for the final lesson? ðŸš€
