# Lesson 6.10: OAuth Configuration per Environment

## A. Concept Overview

### What & Why
**Environment-specific OAuth configuration** manages different OAuth client IDs, secrets, and redirect URIs per environment. Essentialâ€”use test OAuth apps in dev, production OAuth apps in prod.

### Analogy
Like having test credit cards for staging and real cards for productionâ€”same payment flow, different credentials per environment.

---

## B. Code Implementation

```python
from pydantic import SecretStr, Field
from pydantic_settings import BaseSettings, SettingsConfigDict


class OAuthConfig(BaseSettings):
    """OAuth configuration per environment."""
    
    client_id: str
    client_secret: SecretStr
    redirect_uri: str
    auth_url: str
    token_url: str
    scope: str = "read:user"
    
    model_config = SettingsConfigDict(
        env_file=".env",
        env_prefix="OAUTH_",
        case_sensitive=False
    )


# .env.development:
# OAUTH_CLIENT_ID=dev_client_123
# OAUTH_CLIENT_SECRET=dev_secret_xyz
# OAUTH_REDIRECT_URI=http://localhost:3000/callback
# OAUTH_AUTH_URL=https://oauth.dev.example.com/authorize
# OAUTH_TOKEN_URL=https://oauth.dev.example.com/token

# .env.production:
# OAUTH_CLIENT_ID=prod_client_abc
# OAUTH_CLIENT_SECRET=prod_secret_secure
# OAUTH_REDIRECT_URI=https://app.example.com/callback
# OAUTH_AUTH_URL=https://oauth.example.com/authorize
# OAUTH_TOKEN_URL=https://oauth.example.com/token


# Usage
oauth_config = OAuthConfig()

def exchange_code_for_token(code: str):
    response = httpx.post(
        oauth_config.token_url,
        data={
            "grant_type": "authorization_code",
            "code": code,
            "client_id": oauth_config.client_id,
            "client_secret": oauth_config.client_secret.get_secret_value(),
            "redirect_uri": oauth_config.redirect_uri
        }
    )
    return response.json()
```

---

## C. Connect & Apply

Load OAuth config per environment, test token exchange.

---

## D. Common Stumbling Blocks

**Mistake:** Using prod OAuth client in dev
**Fix:** Separate OAuth applications per environment

---

## ðŸŽ¯ Key Takeaways

âœ… Separate OAuth clients per environment  
âœ… SecretStr for client secrets  
âœ… Different redirect URIs per environment  

---

## What's Next?

Next: **JWT Tokens Explained**!

**Ready to continue?** ðŸš€
