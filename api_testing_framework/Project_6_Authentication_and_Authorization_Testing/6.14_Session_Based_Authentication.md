# Lesson 6.14: Session Based Authentication

## A. Concept Overview

### What & Why
**Session-based authentication** uses server-side sessions with session IDs stored in cookies. Common in web applications, important to test cookie handling and session lifecycle.

### Analogy
Session auth is like a coat checkâ€”you check your coat (log in), get a ticket number (session ID), show ticket to retrieve coat (access resources). Ticket in your pocket (cookie), coat stored in checkroom (server session).

---

## B. Code Implementation

```python
import httpx


def test_session_login():
    """Test session-based login with cookies."""
    
    client = httpx.Client(base_url="https://api.example.com")
    
    # Login and receive session cookie
    response = client.post(
        "/login",
        json={"username": "testuser", "password": "testpass"}
    )
    
    assert response.status_code == 200
    
    # httpx automatically stores cookies
    assert len(client.cookies) > 0
    
    # Subsequent requests include session cookie automatically
    profile_response = client.get("/profile")
    assert profile_response.status_code == 200


def test_session_logout():
    """Test session logout clears cookies."""
    
    client = httpx.Client(base_url="https://api.example.com")
    
    # Login
    client.post("/login", json={"username": "test", "password": "pass"})
    
    # Logout
    response = client.post("/logout")
    assert response.status_code == 200
    
    # Session cookie should be cleared
    # Subsequent requests should fail
    profile_response = client.get("/profile")
    assert profile_response.status_code == 401
```

---

## C. Connect & Apply

Test session login/logout flows with httpx cookie handling.

---

## D. Common Stumbling Blocks

**Mistake:** Not preserving cookies between requests
**Fix:** Use same httpx.Client instance to maintain session

---

## ðŸŽ¯ Key Takeaways

âœ… Server stores session state  
âœ… Client stores session ID in cookie  
âœ… httpx automatically manages cookies  
âœ… Use same client instance for session continuity  

---

## What's Next?

Next: **Cookie Authentication with httpx**!

**Ready to continue?** ðŸš€
