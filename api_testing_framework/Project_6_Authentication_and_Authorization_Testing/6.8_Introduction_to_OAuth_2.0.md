# Lesson 6.8: Introduction to OAuth 2.0

## A. Concept Overview

### What & Why
**OAuth 2.0** is an authorization framework allowing third-party applications to access user data without exposing passwords. Critical for testing social login, API integrations, and delegated access.

### Analogy
OAuth is like valet parkingâ€”you give the valet (third-party app) a special key that only starts the car and doesn't open the trunk (limited access), instead of your full keychain (password).

---

## B. Code Implementation

```python
import httpx


def oauth_authorization_code_flow():
    """
    OAuth 2.0 Authorization Code Flow (most common).
    
    Steps:
    1. Redirect user to authorization server
    2. User logs in and grants permission
    3. Server redirects back with authorization code
    4. Exchange code for access token
    5. Use access token for API requests
    """
    
    # Step 1: Build authorization URL
    auth_url = (
        "https://oauth.example.com/authorize?"
        "client_id=YOUR_CLIENT_ID&"
        "redirect_uri=https://yourapp.com/callback&"
        "response_type=code&"
        "scope=read:user,write:posts"
    )
    print(f"1. Redirect user to: {auth_url}")
    
    # Step 2-3: User logs in, you receive code
    authorization_code = "received_from_redirect"
    
    # Step 4: Exchange code for token
    token_response = httpx.post(
        "https://oauth.example.com/token",
        data={
            "grant_type": "authorization_code",
            "code": authorization_code,
            "client_id": "YOUR_CLIENT_ID",
            "client_secret": "YOUR_CLIENT_SECRET",
            "redirect_uri": "https://yourapp.com/callback"
        }
    )
    
    access_token = token_response.json()["access_token"]
    
    # Step 5: Use access token
    client = httpx.Client(
        base_url="https://api.example.com",
        headers={"Authorization": f"Bearer {access_token}"}
    )
    
    response = client.get("/user/profile")
    return response


# OAuth Client Credentials Flow (machine-to-machine)
def oauth_client_credentials_flow():
    """
    OAuth 2.0 Client Credentials Flow.
    For service-to-service authentication.
    """
    
    # Request token
    token_response = httpx.post(
        "https://oauth.example.com/token",
        data={
            "grant_type": "client_credentials",
            "client_id": "YOUR_CLIENT_ID",
            "client_secret": "YOUR_CLIENT_SECRET",
            "scope": "read:data"
        }
    )
    
    access_token = token_response.json()["access_token"]
    
    # Use token
    client = httpx.Client(
        base_url="https://api.example.com",
        headers={"Authorization": f"Bearer {access_token}"}
    )
    
    return client
```

---

## C. Connect & Apply

Study OAuth flows and test token exchange.

---

## D. Common Stumbling Blocks

**Mistake:** Confusing OAuth flows
**Fix:** Authorization Code for users, Client Credentials for services

---

## ðŸŽ¯ Key Takeaways

âœ… OAuth 2.0 for delegated access  
âœ… Authorization Code for user login  
âœ… Client Credentials for service auth  
âœ… Always HTTPS for OAuth  

---

## What's Next?

Next: **Testing OAuth Flows with httpx**!

**Ready to continue?** ðŸš€
