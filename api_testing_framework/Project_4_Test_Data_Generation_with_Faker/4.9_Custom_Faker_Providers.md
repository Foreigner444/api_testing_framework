# 4.9 Custom Faker Providers

## A. Concept Overview

### What & Why
While Faker provides hundreds of built-in methods, sometimes you need **domain-specific data** unique to your application â€“ custom product codes, internal status values, or business-specific formats. **Custom providers** let you extend Faker with your own data generators, keeping your test data generation consistent and centralized.

### Analogy
Think of custom providers like **adding your own special menu items to a restaurant**.

Faker's built-in methods are the standard menu:
- Burgers, fries, drinks (names, emails, addresses)

Custom providers are your signature dishes:
- Secret sauce burger (custom product SKU)
- House special fries (internal order status)
- Proprietary smoothie (custom ID format)

You extend the menu without changing the kitchen!

---

## B. Code Implementation

### File Path: `providers/custom_providers.py`

```python
"""Custom Faker providers for domain-specific data."""
from faker import Faker
from faker.providers import BaseProvider
import random
import string


# ==================== Custom Provider Example 1: Product Codes ====================

class ProductProvider(BaseProvider):
    """Custom provider for product-related data."""
    
    def product_sku(self) -> str:
        """Generate a product SKU in format: PROD-XXXXX."""
        random_num = self.random_int(10000, 99999)
        return f"PROD-{random_num}"
    
    def product_category(self) -> str:
        """Generate a random product category."""
        categories = [
            "Electronics",
            "Clothing",
            "Home & Garden",
            "Sports & Outdoors",
            "Books",
            "Toys & Games",
            "Health & Beauty",
            "Automotive"
        ]
        return self.random_element(categories)
    
    def product_status(self) -> str:
        """Generate product status."""
        statuses = ["in_stock", "out_of_stock", "pre_order", "discontinued"]
        return self.random_element(statuses)
    
    def product_condition(self) -> str:
        """Generate product condition."""
        conditions = ["new", "refurbished", "used_like_new", "used_good", "used_acceptable"]
        return self.random_element(conditions)


# ==================== Custom Provider Example 2: Order System ====================

class OrderProvider(BaseProvider):
    """Custom provider for order-related data."""
    
    def order_id(self) -> str:
        """Generate order ID in format: ORD-YYYYMMDD-XXXXX."""
        from datetime import datetime
        date_str = datetime.now().strftime("%Y%m%d")
        random_num = self.random_int(10000, 99999)
        return f"ORD-{date_str}-{random_num}"
    
    def order_status(self) -> str:
        """Generate order status."""
        statuses = [
            "pending",
            "confirmed",
            "processing",
            "shipped",
            "delivered",
            "cancelled",
            "refunded"
        ]
        return self.random_element(statuses)
    
    def payment_method(self) -> str:
        """Generate payment method."""
        methods = [
            "credit_card",
            "debit_card",
            "paypal",
            "apple_pay",
            "google_pay",
            "bank_transfer"
        ]
        return self.random_element(methods)
    
    def shipping_method(self) -> str:
        """Generate shipping method."""
        methods = [
            "standard",
            "express",
            "overnight",
            "two_day",
            "international"
        ]
        return self.random_element(methods)


# ==================== Custom Provider Example 3: User System ====================

class UserSystemProvider(BaseProvider):
    """Custom provider for user system data."""
    
    def user_role(self) -> str:
        """Generate user role."""
        roles = ["admin", "moderator", "user", "guest", "premium_user"]
        return self.random_element(roles)
    
    def subscription_tier(self) -> str:
        """Generate subscription tier."""
        tiers = ["free", "basic", "premium", "enterprise"]
        return self.random_element(tiers)
    
    def account_status(self) -> str:
        """Generate account status."""
        statuses = ["active", "inactive", "suspended", "pending_verification", "deleted"]
        return self.random_element(statuses)
    
    def verification_code(self) -> str:
        """Generate 6-digit verification code."""
        return f"{self.random_int(100000, 999999)}"
    
    def api_key(self) -> str:
        """Generate API key."""
        chars = string.ascii_letters + string.digits
        key = ''.join(self.random_choices(chars, length=32))
        return f"ak_{key}"


# ==================== Custom Provider Example 4: Transaction ====================

class TransactionProvider(BaseProvider):
    """Custom provider for financial transactions."""
    
    def transaction_id(self) -> str:
        """Generate transaction ID."""
        chars = string.ascii_uppercase + string.digits
        tx_id = ''.join(self.random_choices(chars, length=16))
        return f"TXN-{tx_id}"
    
    def currency_code(self) -> str:
        """Generate currency code."""
        currencies = ["USD", "EUR", "GBP", "JPY", "CAD", "AUD", "CHF"]
        return self.random_element(currencies)
    
    def transaction_type(self) -> str:
        """Generate transaction type."""
        types = ["purchase", "refund", "transfer", "withdrawal", "deposit"]
        return self.random_element(types)


# ==================== Custom Provider Example 5: API Testing ====================

class APITestProvider(BaseProvider):
    """Custom provider for API testing specific data."""
    
    def http_method(self) -> str:
        """Generate HTTP method."""
        methods = ["GET", "POST", "PUT", "PATCH", "DELETE"]
        return self.random_element(methods)
    
    def http_status_code(self, category: str = "any") -> int:
        """Generate HTTP status code."""
        codes = {
            "success": [200, 201, 202, 204],
            "redirect": [301, 302, 303, 304, 307, 308],
            "client_error": [400, 401, 403, 404, 405, 409, 422, 429],
            "server_error": [500, 501, 502, 503, 504],
            "any": [200, 201, 400, 401, 403, 404, 500, 502, 503]
        }
        return self.random_element(codes.get(category, codes["any"]))
    
    def api_version(self) -> str:
        """Generate API version."""
        major = self.random_int(1, 3)
        minor = self.random_int(0, 9)
        patch = self.random_int(0, 20)
        return f"v{major}.{minor}.{patch}"
    
    def correlation_id(self) -> str:
        """Generate correlation ID for request tracing."""
        import uuid
        return str(uuid.uuid4())


# ==================== Usage Example ====================

def setup_faker_with_custom_providers():
    """Setup Faker with all custom providers."""
    fake = Faker()
    
    # Add custom providers
    fake.add_provider(ProductProvider)
    fake.add_provider(OrderProvider)
    fake.add_provider(UserSystemProvider)
    fake.add_provider(TransactionProvider)
    fake.add_provider(APITestProvider)
    
    return fake


if __name__ == "__main__":
    fake = setup_faker_with_custom_providers()
    
    print("Custom Provider Examples:")
    print(f"Product SKU: {fake.product_sku()}")
    print(f"Order ID: {fake.order_id()}")
    print(f"User Role: {fake.user_role()}")
    print(f"Transaction ID: {fake.transaction_id()}")
    print(f"HTTP Status: {fake.http_status_code()}")
```

---

### File Path: `tests/test_custom_providers.py`

```python
"""Tests for custom Faker providers."""
import pytest
from faker import Faker
from providers.custom_providers import (
    ProductProvider,
    OrderProvider,
    UserSystemProvider,
    TransactionProvider,
    APITestProvider,
    setup_faker_with_custom_providers
)


# ==================== PRODUCT PROVIDER TESTS ====================

def test_product_sku():
    """Test custom product SKU generation."""
    fake = Faker()
    fake.add_provider(ProductProvider)
    
    sku = fake.product_sku()
    
    # Should match format PROD-XXXXX
    assert sku.startswith("PROD-")
    assert len(sku) == 10  # PROD- + 5 digits
    assert sku.split("-")[1].isdigit()
    
    print(f"âœ… Product SKU: {sku}")


def test_product_category():
    """Test product category generation."""
    fake = Faker()
    fake.add_provider(ProductProvider)
    
    category = fake.product_category()
    
    # Should be one of the defined categories
    valid_categories = [
        "Electronics", "Clothing", "Home & Garden",
        "Sports & Outdoors", "Books", "Toys & Games",
        "Health & Beauty", "Automotive"
    ]
    
    assert category in valid_categories
    
    print(f"âœ… Category: {category}")


def test_product_status():
    """Test product status generation."""
    fake = Faker()
    fake.add_provider(ProductProvider)
    
    status = fake.product_status()
    
    valid_statuses = ["in_stock", "out_of_stock", "pre_order", "discontinued"]
    assert status in valid_statuses
    
    print(f"âœ… Product status: {status}")


# ==================== ORDER PROVIDER TESTS ====================

def test_order_id():
    """Test custom order ID generation."""
    fake = Faker()
    fake.add_provider(OrderProvider)
    
    order_id = fake.order_id()
    
    # Should match format ORD-YYYYMMDD-XXXXX
    assert order_id.startswith("ORD-")
    parts = order_id.split("-")
    assert len(parts) == 3
    assert len(parts[1]) == 8  # YYYYMMDD
    assert len(parts[2]) == 5  # XXXXX
    
    print(f"âœ… Order ID: {order_id}")


def test_order_status():
    """Test order status generation."""
    fake = Faker()
    fake.add_provider(OrderProvider)
    
    status = fake.order_status()
    
    valid_statuses = [
        "pending", "confirmed", "processing",
        "shipped", "delivered", "cancelled", "refunded"
    ]
    assert status in valid_statuses
    
    print(f"âœ… Order status: {status}")


def test_payment_method():
    """Test payment method generation."""
    fake = Faker()
    fake.add_provider(OrderProvider)
    
    method = fake.payment_method()
    
    valid_methods = [
        "credit_card", "debit_card", "paypal",
        "apple_pay", "google_pay", "bank_transfer"
    ]
    assert method in valid_methods
    
    print(f"âœ… Payment method: {method}")


# ==================== USER SYSTEM PROVIDER TESTS ====================

def test_user_role():
    """Test user role generation."""
    fake = Faker()
    fake.add_provider(UserSystemProvider)
    
    role = fake.user_role()
    
    valid_roles = ["admin", "moderator", "user", "guest", "premium_user"]
    assert role in valid_roles
    
    print(f"âœ… User role: {role}")


def test_verification_code():
    """Test verification code generation."""
    fake = Faker()
    fake.add_provider(UserSystemProvider)
    
    code = fake.verification_code()
    
    # Should be 6 digits
    assert len(code) == 6
    assert code.isdigit()
    
    print(f"âœ… Verification code: {code}")


def test_api_key():
    """Test API key generation."""
    fake = Faker()
    fake.add_provider(UserSystemProvider)
    
    api_key = fake.api_key()
    
    # Should start with ak_
    assert api_key.startswith("ak_")
    
    # Should be reasonable length
    assert len(api_key) > 30
    
    print(f"âœ… API key: {api_key}")


# ==================== TRANSACTION PROVIDER TESTS ====================

def test_transaction_id():
    """Test transaction ID generation."""
    fake = Faker()
    fake.add_provider(TransactionProvider)
    
    txn_id = fake.transaction_id()
    
    # Should start with TXN-
    assert txn_id.startswith("TXN-")
    
    # Should have alphanumeric ID
    assert len(txn_id) > 15
    
    print(f"âœ… Transaction ID: {txn_id}")


def test_currency_code():
    """Test currency code generation."""
    fake = Faker()
    fake.add_provider(TransactionProvider)
    
    currency = fake.currency_code()
    
    # Should be 3-letter code
    assert len(currency) == 3
    assert currency.isupper()
    
    valid_currencies = ["USD", "EUR", "GBP", "JPY", "CAD", "AUD", "CHF"]
    assert currency in valid_currencies
    
    print(f"âœ… Currency: {currency}")


# ==================== API TEST PROVIDER TESTS ====================

def test_http_method():
    """Test HTTP method generation."""
    fake = Faker()
    fake.add_provider(APITestProvider)
    
    method = fake.http_method()
    
    valid_methods = ["GET", "POST", "PUT", "PATCH", "DELETE"]
    assert method in valid_methods
    
    print(f"âœ… HTTP method: {method}")


def test_http_status_code():
    """Test HTTP status code generation."""
    fake = Faker()
    fake.add_provider(APITestProvider)
    
    # Any status
    status = fake.http_status_code()
    assert 100 <= status < 600
    
    # Success codes
    success = fake.http_status_code(category="success")
    assert 200 <= success < 300
    
    # Error codes
    error = fake.http_status_code(category="client_error")
    assert 400 <= error < 500
    
    print(f"âœ… Status codes: {status}, {success}, {error}")


def test_api_version():
    """Test API version generation."""
    fake = Faker()
    fake.add_provider(APITestProvider)
    
    version = fake.api_version()
    
    # Should match format vX.Y.Z
    assert version.startswith("v")
    assert version.count(".") == 2
    
    print(f"âœ… API version: {version}")


def test_correlation_id():
    """Test correlation ID generation."""
    fake = Faker()
    fake.add_provider(APITestProvider)
    
    corr_id = fake.correlation_id()
    
    # Should be UUID format
    assert len(corr_id) == 36
    assert corr_id.count("-") == 4
    
    print(f"âœ… Correlation ID: {corr_id}")


# ==================== COMBINED USAGE ====================

def test_all_custom_providers():
    """Test using all custom providers together."""
    fake = setup_faker_with_custom_providers()
    
    # Product data
    product_sku = fake.product_sku()
    category = fake.product_category()
    
    # Order data
    order_id = fake.order_id()
    order_status = fake.order_status()
    
    # User data
    role = fake.user_role()
    api_key = fake.api_key()
    
    # Transaction data
    txn_id = fake.transaction_id()
    currency = fake.currency_code()
    
    # API test data
    method = fake.http_method()
    status_code = fake.http_status_code()
    
    # All should be generated
    assert all([
        product_sku, category, order_id, order_status,
        role, api_key, txn_id, currency, method, status_code
    ])
    
    print(f"âœ… All custom providers work!")
    print(f"   Product: {product_sku} ({category})")
    print(f"   Order: {order_id} - {order_status}")
    print(f"   User: {role} - {api_key[:20]}...")
    print(f"   Transaction: {txn_id} ({currency})")
    print(f"   API: {method} - {status_code}")


def test_generate_complete_product():
    """Test generating complete product using custom providers."""
    fake = setup_faker_with_custom_providers()
    
    product = {
        "sku": fake.product_sku(),
        "name": fake.sentence(nb_words=3).replace(".", "").title(),
        "category": fake.product_category(),
        "price": fake.pyfloat(min_value=1, max_value=1000, right_digits=2),
        "status": fake.product_status(),
        "condition": fake.product_condition(),
        "description": fake.text(max_nb_chars=200)
    }
    
    # Validate all fields
    assert all(value is not None for value in product.values())
    assert product["sku"].startswith("PROD-")
    assert 1 <= product["price"] <= 1000
    
    print(f"âœ… Complete product generated!")
    print(f"   {product['sku']}: {product['name']}")
    print(f"   Category: {product['category']}")
    print(f"   Price: ${product['price']:.2f}")
    print(f"   Status: {product['status']}")


def test_generate_complete_order():
    """Test generating complete order using custom providers."""
    fake = setup_faker_with_custom_providers()
    
    order = {
        "order_id": fake.order_id(),
        "customer_name": fake.name(),
        "customer_email": fake.email(),
        "status": fake.order_status(),
        "payment_method": fake.payment_method(),
        "shipping_method": fake.shipping_method(),
        "total": fake.pyfloat(min_value=10, max_value=1000, right_digits=2),
        "currency": fake.currency_code(),
        "created_at": fake.date_time_this_year()
    }
    
    # Validate
    assert order["order_id"].startswith("ORD-")
    assert "@" in order["customer_email"]
    assert 10 <= order["total"] <= 1000
    
    print(f"âœ… Complete order generated!")
    print(f"   {order['order_id']}: ${order['total']:.2f} {order['currency']}")
    print(f"   Customer: {order['customer_name']}")
    print(f"   Status: {order['status']}")


def test_multiple_providers_uniqueness():
    """Test that custom providers generate unique values."""
    fake = setup_faker_with_custom_providers()
    
    # Generate 100 SKUs
    skus = [fake.product_sku() for _ in range(100)]
    
    # Should be mostly unique
    unique_skus = set(skus)
    uniqueness = len(unique_skus) / len(skus)
    
    assert uniqueness > 0.95  # At least 95% unique
    
    print(f"âœ… Uniqueness: {len(unique_skus)}/{len(skus)} ({uniqueness:.1%})")
```

---

## C. Connect & Apply

### How to Test It

```bash
# Run tests
pytest tests/test_custom_providers.py -v -s
```

### Expected Result

```
tests/test_custom_providers.py::test_product_sku PASSED
âœ… Product SKU: PROD-45782

tests/test_custom_providers.py::test_order_id PASSED
âœ… Order ID: ORD-20241122-67834

tests/test_custom_providers.py::test_all_custom_providers PASSED
âœ… All custom providers work!
   Product: PROD-23456 (Electronics)
   Order: ORD-20241122-78901 - confirmed
   User: admin - ak_Xy9s...

======================== 18 passed in 0.91s =========================
```

---

## D. Creating Your Own Provider

### Template:

```python
from faker.providers import BaseProvider

class MyCustomProvider(BaseProvider):
    """My custom provider."""
    
    def my_custom_method(self) -> str:
        """Generate custom data."""
        # Use self.random_element() for choices
        # Use self.random_int() for numbers
        # Use self.random_choices() for random selection
        return "custom_data"

# Add to Faker
fake = Faker()
fake.add_provider(MyCustomProvider)

# Use it
data = fake.my_custom_method()
```

---

## E. What You've Learned

âœ… Creating custom Faker providers  
âœ… Extending Faker with domain-specific methods  
âœ… Using `BaseProvider` class  
âœ… `random_element()`, `random_int()`, `random_choices()`  
âœ… Adding providers to Faker instances  
âœ… Combining built-in and custom providers  
âœ… Real-world custom provider examples  
âœ… Generating unique identifiers  

---

## F. What's Next?

In **Lesson 4.10 (Seeding for Reproducible Data)**, we'll learn:
- Controlling randomness with seeds
- Reproducible test data
- Debugging with consistent data

Your Faker is now customized! ðŸŽ‰

---

**Ready for the next lesson?**
