# Lesson 5.29: Authentication Configuration

## A. Concept Overview

### What & Why
**Authentication configuration** manages API credentials, tokens, and auth methods across environments, ensuring each environment uses appropriate credentials. Critical for securityâ€”dev uses safe test credentials, production uses secure real credentials.

### Analogy
Authentication config is like having different keycards for different buildingsâ€”your gym card (dev credentials) only works at the gym, your office card (staging) only at the office, and your secure datacenter card (production) only at the datacenter. Each environment gets only the access it needs.

---

## B. Code Implementation

```python
from typing import Optional
from pydantic import Field, SecretStr
from pydantic_settings import BaseSettings
import httpx


class AuthSettings(BaseSettings):
    """Authentication configuration."""
    
    # API Key authentication
    api_key: SecretStr = Field(..., description="API authentication key")
    
    # Bearer token authentication  
    bearer_token: Optional[SecretStr] = Field(default=None)
    
    # Basic auth
    basic_auth_username: Optional[str] = Field(default=None)
    basic_auth_password: Optional[SecretStr] = Field(default=None)
    
    # OAuth
    oauth_client_id: Optional[str] = Field(default=None)
    oauth_client_secret: Optional[SecretStr] = Field(default=None)
    
    def get_auth_headers(self) -> dict:
        """Get authentication headers."""
        headers = {}
        
        # API Key
        if self.api_key:
            headers["X-API-Key"] = self.api_key.get_secret_value()
        
        # Bearer token
        if self.bearer_token:
            headers["Authorization"] = f"Bearer {self.bearer_token.get_secret_value()}"
        
        return headers
    
    def get_basic_auth(self) -> Optional[tuple]:
        """Get basic auth tuple."""
        if self.basic_auth_username and self.basic_auth_password:
            return (
                self.basic_auth_username,
                self.basic_auth_password.get_secret_value()
            )
        return None


# .env.development (safe test credentials)
# API_KEY=dev_test_key_safe_to_share
# BEARER_TOKEN=dev_token_12345

# .env.production (secure real credentials)
# API_KEY=prod_real_key_secret
# BEARER_TOKEN=prod_real_token_secret


def create_authenticated_client(auth: AuthSettings, base_url: str) -> httpx.Client:
    """Create httpx client with authentication."""
    return httpx.Client(
        base_url=base_url,
        headers=auth.get_auth_headers(),
        auth=auth.get_basic_auth()
    )
```

---

## C. Connect & Apply

```python
auth = AuthSettings()
client = create_authenticated_client(auth, "https://api.example.com")
response = client.get("/protected")
```

---

## D. Common Stumbling Blocks

**Mistake:** Committing credentials to git
**Fix:** Use SecretStr and .gitignore .env files

---

## ðŸŽ¯ Key Takeaways

âœ… **SecretStr** for sensitive values  
âœ… **Different credentials** per environment  
âœ… **Never commit** production credentials  
âœ… **Multiple auth methods** supported  

---

## What's Next?

Next: **Secrets and API Keys Management**!

**Ready to continue?** ðŸš€
