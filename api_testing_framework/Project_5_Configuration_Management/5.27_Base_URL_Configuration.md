# Lesson 5.27: Base URL Configuration

## A. Concept Overview

### What & Why
**Base URL configuration** manages API endpoint URLs across environments, ensuring tests target the correct server (localhost in dev, test servers in staging, production servers in prod). Essential for preventing accidental testing against wrong environments.

### Analogy
Base URLs are like mailing addressesâ€”same letter (test), different destination. You want letters to yourself (dev) to go to your home address, business letters (staging) to the office, and official documents (production) to the registered business address.

---

## B. Code Implementation

```python
from pydantic import field_validator
from pydantic_settings import BaseSettings


class Settings(BaseSettings):
    api_base_url: str
    environment: str
    
    @field_validator("api_base_url")
    @classmethod
    def validate_base_url(cls, v: str, info) -> str:
        """Validate URL matches environment."""
        environment = info.data.get("environment", "")
        
        if environment == "production":
            if "localhost" in v or "127.0.0.1" in v:
                raise ValueError(
                    "Production cannot use localhost URLs"
                )
            if not v.startswith("https://"):
                raise ValueError(
                    "Production must use HTTPS"
                )
        
        # Normalize: remove trailing slash
        return v.rstrip("/")


# .env.development
# API_BASE_URL=http://localhost:8000
# ENVIRONMENT=development

# .env.production  
# API_BASE_URL=https://api.example.com
# ENVIRONMENT=production
```

---

## C. Connect & Apply

```python
settings = Settings()
print(f"Testing against: {settings.api_base_url}")
```

---

## D. Common Stumbling Blocks

**Mistake:** Hardcoding base URLs in tests
**Fix:** Always use settings.api_base_url

---

## ðŸŽ¯ Key Takeaways

âœ… **Never hardcode** base URLs  
âœ… **Validate** URLs match environment  
âœ… **Normalize** URLs (remove trailing slash)  
âœ… **Require HTTPS** in production  

---

## What's Next?

Next: **Timeout Configuration per Environment**!

**Ready to continue?** ðŸš€
