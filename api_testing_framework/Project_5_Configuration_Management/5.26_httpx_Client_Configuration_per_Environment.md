# Lesson 5.26: httpx Client Configuration per Environment

## A. Concept Overview

### What & Why
**Environment-specific httpx client configuration** ensures your HTTP client is properly configured for each deployment environment with appropriate timeouts, retries, and connection settings. Critical for reliabilityâ€”development uses fast timeouts for quick feedback, production uses longer timeouts for stability.

### Analogy
Like adjusting your car's settings for different terrainsâ€”city driving (development) uses responsive steering and quick braking, while highway driving (production) uses cruise control and smoother, longer braking distances. Same car, optimized for different conditions.

---

## B. Code Implementation

```python
from pydantic import Field
from pydantic_settings import BaseSettings, SettingsConfigDict
import httpx
from typing import Optional


class HTTPXConfig(BaseSettings):
    """httpx client configuration."""
    
    api_base_url: str
    api_key: str
    timeout: int = 30
    max_retries: int = 3
    verify_ssl: bool = True
    http2: bool = False
    pool_limits_max_keepalive: int = 20
    pool_limits_max_connections: int = 100
    
    model_config = SettingsConfigDict(
        env_file=".env",
        env_prefix="API_",
        case_sensitive=False
    )
    
    def create_client(self) -> httpx.Client:
        """Create configured httpx client."""
        return httpx.Client(
            base_url=self.api_base_url,
            headers={"Authorization": f"Bearer {self.api_key}"},
            timeout=httpx.Timeout(self.timeout),
            verify=self.verify_ssl,
            http2=self.http2,
            limits=httpx.Limits(
                max_keepalive_connections=self.pool_limits_max_keepalive,
                max_connections=self.pool_limits_max_connections
            )
        )


# .env.development:
# API_BASE_URL=http://localhost:8000
# API_KEY=dev_key
# API_TIMEOUT=10
# API_MAX_RETRIES=1
# API_VERIFY_SSL=false
# API_HTTP2=false

# .env.production:
# API_BASE_URL=https://api.example.com
# API_KEY=prod_key
# API_TIMEOUT=60
# API_MAX_RETRIES=5
# API_VERIFY_SSL=true
# API_HTTP2=true
```

---

## C. Connect & Apply

```python
config = HTTPXConfig()
client = config.create_client()
response = client.get("/health")
```

---

## D. Common Stumbling Blocks

**Mistake:** Same timeout for all environments
**Fix:** Use environment-specific timeouts

---

## ðŸŽ¯ Key Takeaways

âœ… **Environment-specific** httpx configuration  
âœ… **Shorter timeouts** in development for fast feedback  
âœ… **Longer timeouts** in production for reliability  
âœ… **Connection pooling** settings per environment  

---

## What's Next?

Next: **Base URL Configuration**!

**Ready to continue?** ðŸš€
