# Lesson 2.4: Installing pytest-asyncio

## A. Concept Overview

### What & Why
**pytest-asyncio** is a pytest plugin that adds support for async test functions. It's essential because pytest doesn't natively understand async/awaitâ€”this plugin provides the magic that makes async tests work seamlessly.

### Analogy
pytest-asyncio is like adding a turbo charger to your car (pytest). The car works fine without it, but the turbo (async support) lets it go much faster when needed!

---

## B. Installing pytest-asyncio

```bash
# Activate virtual environment
source venv/bin/activate

# Install pytest-asyncio
pip install pytest-asyncio

# Verify
python -c "import pytest_asyncio; print(pytest_asyncio.__version__)"
```

Expected output: `0.23.0` or similar

---

## C. Update requirements.txt

File: `requirements.txt`
```
# Testing Framework
pytest>=8.0.0
pytest-asyncio>=0.21.0

# HTTP Client
httpx[http2]>=0.27.0
```

Install all:
```bash
pip install -r requirements.txt
```

---

## D. Configure pytest for Async

File: `pytest.ini`
```ini
[pytest]
asyncio_mode = auto  # Automatically detect async tests
testpaths = tests
python_files = test_*.py
python_functions = test_*
addopts = -v --tb=short -ra
```

**asyncio_mode options**:
- `auto`: Automatically detects and runs async tests (recommended)
- `strict`: Requires explicit @pytest.mark.asyncio
- Default: `strict`

---

## E. Verification Test

File: `tests/test_async_setup.py`
```python
"""Verify pytest-asyncio is working."""
import pytest
import asyncio


@pytest.mark.asyncio
async def test_pytest_asyncio_works():
    """Test that async tests run."""
    await asyncio.sleep(0.1)
    assert True


@pytest.mark.asyncio
async def test_async_assertion():
    """Test async with assertion."""
    result = await async_add(2, 3)
    assert result == 5


async def async_add(a, b):
    """Example async function."""
    await asyncio.sleep(0.01)
    return a + b
```

Run:
```bash
pytest tests/test_async_setup.py -v
```

Expected: All tests pass âœ…

---

## F. Key Takeaways

ðŸ”‘ **pytest-asyncio**: Essential plugin for async tests  
ðŸ”‘ **@pytest.mark.asyncio**: Marks async tests  
ðŸ”‘ **asyncio_mode=auto**: Simplifies configuration  
ðŸ”‘ **Installation**: `pip install pytest-asyncio`  

---

## G. What's Next?

Lesson 2.5: Your First Async Test - Write a complete async API test!

Ready? ðŸš€
