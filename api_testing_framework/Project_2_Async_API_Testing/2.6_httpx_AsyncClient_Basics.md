# Lesson 2.6: httpx AsyncClient Basics

## A. Concept Overview

### What & Why
**httpx.AsyncClient** is the async version of httpx.Client, designed for concurrent HTTP requests. It's important because it enables non-blocking I/O, connection pooling, and parallel execution of API tests.

### Analogy
If httpx.Client is a taxi (one trip at a time), AsyncClient is a ride-sharing service (multiple passengers, optimized routes, maximum efficiency).

---

## B. Creating AsyncClient

### Basic Creation

```python
import httpx

@pytest.mark.asyncio
async def test_basic_async_client():
    """Basic AsyncClient usage."""
    # Create and use async client
    async with httpx.AsyncClient() as client:
        response = await client.get("https://jsonplaceholder.typicode.com/users/1")
        assert response.status_code == 200
    # Automatically closed when exiting context
```

---

### AsyncClient with Configuration

```python
@pytest.mark.asyncio
async def test_configured_async_client():
    """AsyncClient with configuration."""
    async with httpx.AsyncClient(
        base_url="https://jsonplaceholder.typicode.com",
        timeout=10.0,
        headers={"User-Agent": "AsyncTestSuite/1.0"}
    ) as client:
        response = await client.get("/users/1")
        assert response.status_code == 200
```

---

## C. All HTTP Methods with AsyncClient

```python
@pytest.mark.asyncio
async def test_all_http_methods_async():
    """Test all HTTP methods with AsyncClient."""
    base_url = "https://jsonplaceholder.typicode.com"
    
    async with httpx.AsyncClient(base_url=base_url) as client:
        # GET
        get_response = await client.get("/posts/1")
        assert get_response.status_code == 200
        
        # POST
        post_response = await client.post(
            "/posts",
            json={"title": "Test", "body": "Content", "userId": 1}
        )
        assert post_response.status_code == 201
        
        # PUT
        put_response = await client.put(
            "/posts/1",
            json={"id": 1, "title": "Updated", "body": "New", "userId": 1}
        )
        assert put_response.status_code == 200
        
        # PATCH
        patch_response = await client.patch(
            "/posts/1",
            json={"title": "Patched"}
        )
        assert patch_response.status_code == 200
        
        # DELETE
        delete_response = await client.delete("/posts/1")
        assert delete_response.status_code == 200
```

---

## D. Concurrent Requests

```python
@pytest.mark.asyncio
async def test_concurrent_gets():
    """Make multiple GET requests concurrently."""
    async with httpx.AsyncClient(base_url="https://jsonplaceholder.typicode.com") as client:
        # All execute concurrently
        responses = await asyncio.gather(
            client.get("/users/1"),
            client.get("/users/2"),
            client.get("/users/3"),
            client.get("/posts/1"),
            client.get("/comments/1")
        )
        
        # All should succeed
        for response in responses:
            assert response.status_code == 200
```

---

## E. AsyncClient Configuration Options

```python
import httpx

async with httpx.AsyncClient(
    base_url="https://api.example.com",
    headers={"Authorization": "Bearer token"},
    timeout=httpx.Timeout(10.0),
    follow_redirects=True,
    max_redirects=5,
    http2=True,  # Enable HTTP/2
    limits=httpx.Limits(
        max_keepalive_connections=20,
        max_connections=100
    )
) as client:
    response = await client.get("/endpoint")
```

---

## F. Key Takeaways

ðŸ”‘ **AsyncClient**: Async version of Client  
ðŸ”‘ **async with**: Required for AsyncClient  
ðŸ”‘ **await**: Required for all operations  
ðŸ”‘ **Configuration**: Same as sync Client  
ðŸ”‘ **Concurrent**: Use gather() for parallel  

---

## G. What's Next?

Lesson 2.7: Async Context Managers!

Ready? ðŸš€
